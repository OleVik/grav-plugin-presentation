{% set theme_config = attribute(config.themes, config.system.pages.theme) %}
<!DOCTYPE html>
<html lang="{{ grav.language.getLanguage ?: 'en' }}">
  {% block head %}
  <head>
    {% block meta %}
      <meta charset="utf-8" />
      <title>{% if header.title %}{{ header.title|e('html') }} | {% endif %}{{ site.title|e('html') }}</title>
      {% include 'partials/metadata.html.twig' %}
      <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    {% endblock meta %}
    <link rel="icon" type="image/png" href="{{ url('theme://images/favicon.png') }}" />
    <link rel="canonical" href="{{ page.url(true, true) }}" />
    {% block stylesheets %}
      {% if config.plugins['presentation'].transition %}
        {% do assets.addCss('plugin://presentation/css/transition.css', {'group': 'critical'}) %}
      {% endif %}
      {% if config.plugins['presentation'].builtin_css %}
        {% do assets.addCss('plugin://presentation/node_modules/reveal.js/css/reveal.css', {'group': 'presentation'}) %}
        {% if uri.query('showNotes') == 'true' and uri.query('print') == true %}
          {% do assets.addCss('plugin://presentation/node_modules/reveal.js/css/theme/white.css', {'group': 'presentation'}) %}
          {% do assets.addCss('plugin://presentation/node_modules/reveal.js/css/print/pdf.css', {'group': 'presentation'}) %}
        {% else %}
          {% do assets.addCss('plugin://presentation/css/presentation.css', {'group': 'presentation'}) %}
        {% endif %}
      {% endif %}
      {% if config.plugins['presentation'].theme != 'none' %}
        {% do assets.addCss('user://plugins/presentation/node_modules/reveal.js/css/theme/' ~ config.plugins['presentation'].theme ~ '.css', {'group': 'presentation'}) %}
      {% endif %}
      {% if config.plugins['presentation'].theme_css %}
        {% do assets.addCss('theme://css/custom.css') %}
      {% endif %}
    {% endblock %}
    {{ assets.css('critical')|raw }}
    {{ assets.css('presentation')|raw }}
  </head>
  {% endblock head %}

  <body id="top" class="{{ page.header.body_classes }}">
    {% if config.plugins['presentation'].transition %}
    <div id="page_transition">
      <div class="la-line-scale la-dark la-3x">
        <div style="color: #0B110D;"></div>
        <div style="color: #2C4D56;"></div>
        <div style="color: #C3AA72;"></div>
        <div style="color: #DC7612;"></div>
        <div style="color: #BD3200;"></div>
      </div>
    </div>
    {% endif %}
    {% block content %}
    <div class="reveal" id="presentation">
      <div class="slides">
        {{ page.content|raw }}
      </div>
    </div>
    {% endblock content %}
    {% block plugin_init %}
      {% if config.plugins['presentation'].builtin_js and config.plugins['presentation'].transition %}
      <script type="text/javascript">
      window.addEventListener("load", function(event) {
        javascript:document.getElementById("page_transition").style.visibility="hidden";
        javascript:document.getElementById("page_transition").style.opacity=0;
        javascript:document.getElementById("page_transition").style.display="none";
      }, false);
      </script>
      {% endif %}
    {% endblock %}
    {% block scripts %}
      {% do assets.addInlineJs('const reveal_init = ' ~ reveal_init ~ ';') %}
      {% do assets.addInlineJs('const presentationAPIRoute = "/' ~ config.plugins['presentation'].api_route ~ '";') %}
      {% do assets.addInlineJs('const presentationAPITimeout = ' ~ config.plugins['presentation'].poll_timeout ~ ';') %}
      {% do assets.addInlineJs('const presentationAPIRetryLimit = ' ~ config.plugins['presentation'].poll_retry_limit ~ ';') %}
      {% do assets.addInlineJs('const presentationAPIAuth = ' ~ config.plugins['presentation'].token_auth ~ ';') %}
      {% if uri.query('admin') == true %}
        {% do assets.addInlineJs('const presentationAuthToken = "' ~ config.plugins['presentation'].token ~ '";') %}
      {% endif %}
      {% if config.plugins['presentation'].builtin_js %}
        {% do assets.addJs('plugin://presentation/node_modules/reveal.js/lib/js/head.min.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://presentation/node_modules/reveal.js/js/reveal.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://presentation/node_modules/axios/dist/axios.min.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://presentation/node_modules/css-element-queries/src/ResizeSensor.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://presentation/js/presentation.js', {'group': 'presentation'}) %}
      {% endif %}
      {% if config.plugins['presentation'].textsizing %}
        {% do assets.addInlineJs('const presentationTextsizingFactor = ' ~ config.plugins['presentation'].textsizing_factor ~ ';') %}
        {% do assets.addJs('plugin://presentation/js/modularscale.js', {'group': 'bottom'}) %}
      {% endif %}
      {% if config.plugins['nomnoml-uml-diagrams'].enabled %}
        {% do assets.addJs('plugin://nomnoml-uml-diagrams/js/lodash.min.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://nomnoml-uml-diagrams/js/dagre.min.js', {'group': 'presentation'}) %}
        {% do assets.addJs('plugin://nomnoml-uml-diagrams/js/nomnoml.js', {'group': 'presentation'}) %}
      {% endif %}
    {% endblock %}
    {{ assets.js('presentation')|raw }}
    <script type="text/javascript">
    window.addEventListener("load", function(event) {
      Reveal.initialize(reveal_init);
    }, false);
    window.addEventListener("load", function(event) {
      if (findGetParameter('admin') == 'yes') {
        Reveal.addEventListener('ready', function(event) {
          var body = document.getElementById('top');
          body.insertAdjacentHTML('beforeend', '<div id="clockbox"></div>');
          initClock();
          setInterval(initClock, 1000);
        });
      }
    }, false);
    </script>
    {% if config.plugins['presentation'].sync == 'browser' %}
      {% do assets.addJs('plugin://presentation/js/broadcast.js', {'group': 'bottom'}) %}
    {% elseif config.plugins['presentation'].sync == 'poll' %}
      {% do assets.addJs('plugin://presentation/js/poll.js', {'group': 'bottom'}) %}
    {% endif %}
    {% if config.system.debugger.enabled %}
      {{ assets.css() }}
      {{ assets.js() }}
    {% endif %}
    {{ assets.js('bottom') }}
    <div id="snackbar">
      <span id="snackbar-message"></span>
      <a href="javascript:window.location.reload(true)">Reload?</a>
    </div>
  </body>
</html>